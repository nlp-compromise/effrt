!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).efrt={})}(this,(function(t){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var e=function(t,n){for(var e=Math.min(t.length,n.length);e>0;){var r=t.slice(0,e);if(r===n.slice(0,e))return r;e-=1}return""},r=function(t){t.sort();for(var n=1;n<t.length;n++)t[n-1]===t[n]&&t.splice(n,1)},o=function(){this.counts={}},i={init:function(t){void 0===this.counts[t]&&(this.counts[t]=0)},add:function(t,n){void 0===n&&(n=1),this.init(t),this.counts[t]+=n},countOf:function(t){return this.init(t),this.counts[t]},highest:function(t){for(var n=[],e=Object.keys(this.counts),r=0;r<e.length;r++){var o=e[r];n.push([o,this.counts[o]])}return n.sort((function(t,n){return n[1]-t[1]})),t&&(n=n.slice(0,t)),n}};Object.keys(i).forEach((function(t){o.prototype[t]=i[t]}));var s=36,u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",f=u.split("").reduce((function(t,n,e){return t[n]=e,t}),{}),h=function(t){if(void 0!==u[t])return u[t];for(var n=1,e=s,r="";t>=e;t-=e,n++,e*=s);for(;n--;){var o=t%s;r=String.fromCharCode((o<10?48:55)+o)+r,t=(t-o)/s}return r},c=function(t){if(void 0!==f[t])return f[t];for(var n=0,e=1,r=s,o=1;e<t.length;n+=r,e++,r*=s);for(var i=t.length-1;i>=0;i--,o*=s){var u=t.charCodeAt(i)-48;u>10&&(u-=7),n+=u*o}return n},a=";",l=":",d=",",v="!",p=36,g=function(t,n){var e="",r="";t.isTerminal(n)&&(e+=v);for(var o=t.nodeProps(n),i=0;i<o.length;i++){var s=o[i];if("number"!=typeof n[s])if(t.syms[n[s]._n])e+=r+s+t.syms[n[s]._n],r="";else{var u=h(n._n-n[s]._n-1+t.symCount);n[s]._g&&u.length>=n[s]._g.length&&1===n[n[s]._g]?(e+=r+s+(u=n[s]._g),r=d):(e+=r+s+u,r="")}else e+=r+s,r=d}return e},y=function t(n,e){if(!n.visited(e))for(var r=n.nodeProps(e,!0),o=0;o<r.length;o++){var i=r[o],s=e._n-e[i]._n-1;s<p&&n.histRel.add(s),n.histAbs.add(e[i]._n,h(s).length-1),t(n,e[i])}},m=function t(n,e){if(void 0===e._n){for(var r=n.nodeProps(e,!0),o=0;o<r.length;o++)t(n,e[r[o]]);e._n=n.pos++,n.nodes.unshift(e)}},b=function(t){t.nodes=[],t.nodeCount=0,t.syms={},t.symCount=0,t.pos=0,t.optimize(),t.histAbs=new o,t.histRel=new o,m(t,t.root),t.nodeCount=t.nodes.length,t.prepDFS(),y(t,t.root),t.symCount=function(t){t.histAbs=t.histAbs.highest(p);var n=[];n[-1]=0;for(var e=0,r=0,o=3+h(t.nodeCount).length,i=0;i<p&&void 0!==t.histAbs[i];i++)n[i]=t.histAbs[i][1]-o-t.histRel.countOf(p-i-1)+n[i-1],n[i]>=e&&(e=n[i],r=i+1);return r}(t);for(var n=0;n<t.symCount;n++)t.syms[t.histAbs[n][0]]=h(n);for(var e=0;e<t.nodeCount;e++)t.nodes[e]=g(t,t.nodes[e]);for(var r=t.symCount-1;r>=0;r--)t.nodes.unshift(h(r)+l+h(t.nodeCount-t.histAbs[r][0]-1));return t.nodes.join(a)},_=new RegExp("[0-9A-Z,;!:|¦]"),C={insertWords:function(t){if(void 0!==t){"string"==typeof t&&(t=t.split(/[^a-zA-Z]+/));for(var n=0;n<t.length;n++)t[n]=t[n].toLowerCase();r(t);for(var e=0;e<t.length;e++)null===t[e].match(_)&&this.insert(t[e])}},insert:function(t){this._insert(t,this.root);var n=this.lastWord;if(this.lastWord=t,e(t,n)!==n){var r=this.uniqueNode(n,t,this.root);r&&this.combineSuffixNode(r)}},_insert:function(t,r){var o,i;if(0!==t.length){for(var s=Object.keys(r),u=0;u<s.length;u++){var f=s[u];if(0!==(o=e(t,f)).length){if(f===o&&"object"===n(r[f]))return void this._insert(t.slice(o.length),r[f]);if(f===t&&"number"==typeof r[f])return;return(i={})[f.slice(o.length)]=r[f],this.addTerminal(i,t=t.slice(o.length)),delete r[f],r[o]=i,void this.wordCount++}}this.addTerminal(r,t),this.wordCount++}},addTerminal:function(t,n){if(n.length<=1)t[n]=1;else{var e={};t[n[0]]=e,this.addTerminal(e,n.slice(1))}},nodeProps:function(t,e){var r=[];for(var o in t)""!==o&&"_"!==o[0]&&(e&&"object"!==n(t[o])||r.push(o));return r.sort(),r},optimize:function(){this.combineSuffixNode(this.root),this.prepDFS(),this.countDegree(this.root),this.prepDFS(),this.collapseChains(this.root)},combineSuffixNode:function(t){if(t._c)return t;var e=[];this.isTerminal(t)&&e.push("!");for(var r=this.nodeProps(t),o=0;o<r.length;o++){var i=r[o];"object"===n(t[i])?(t[i]=this.combineSuffixNode(t[i]),e.push(i),e.push(t[i]._c)):e.push(i)}e=e.join("-");var s=this.suffixes[e];return s||(this.suffixes[e]=t,t._c=this.cNext++,t)},prepDFS:function(){this.vCur++},visited:function(t){return t._v===this.vCur||(t._v=this.vCur,!1)},countDegree:function(t){if(void 0===t._d&&(t._d=0),t._d++,!this.visited(t))for(var n=this.nodeProps(t,!0),e=0;e<n.length;e++)this.countDegree(t[n[e]])},collapseChains:function(t){var e,r,o,i;if(!this.visited(t)){for(r=this.nodeProps(t),i=0;i<r.length;i++)"object"===n(o=t[e=r[i]])&&(this.collapseChains(o),void 0===o._g||1!==o._d&&1!==o._g.length||(delete t[e],t[e+=o._g]=o[o._g]));1!==r.length||this.isTerminal(t)||(t._g=e)}},isTerminal:function(t){return!!t[""]},uniqueNode:function(t,n,e){for(var r=this.nodeProps(e,!0),o=0;o<r.length;o++){var i=r[o];if(i===t.slice(0,i.length))return i!==n.slice(0,i.length)?e[i]:this.uniqueNode(t.slice(i.length),n.slice(i.length),e[i])}},pack:function(){return b(this)}},j=function(t){this.root={},this.lastWord="",this.suffixes={},this.suffixCounts={},this.cNext=1,this.wordCount=0,this.insertWords(t),this.vCur=0};Object.keys(C).forEach((function(t){j.prototype[t]=C[t]}));var A=function(t){return"[object Array]"===Object.prototype.toString.call(t)},x=function(t,n,e){var r=c(n);return r<t.symCount?t.syms[r]:e+r+1-t.symCount},O=function(t){var n={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&&function(t){for(var n=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),e=0;e<t.nodes.length;e++){var r=n.exec(t.nodes[e]);if(!r){t.symCount=e;break}t.syms[c(r[1])]=c(r[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}(n),function(t){var n=[];return function e(r,o){var i=t.nodes[r];"!"===i[0]&&(n.push(o),i=i.slice(1));for(var s=i.split(/([A-Z0-9,]+)/g),u=0;u<s.length;u+=2){var f=s[u],h=s[u+1];if(f){var c=o+f;","!==h&&void 0!==h?e(x(t,h,r),c):n.push(c)}}}(0,""),n}(n)};t.pack=function(t){var n;t=null==(n=t)?{}:"string"==typeof n?n.split(/ +/g).reduce((function(t,n){return t[n]=!0,t}),{}):A(n)?n.reduce((function(t,n){return t[n]=!0,t}),{}):n;var e=Object.keys(t).reduce((function(n,e){var r=t[e];if(A(r)){for(var o=0;o<r.length;o++)n[r[o]]=n[r[o]]||[],n[r[o]].push(e);return n}return!1===n.hasOwnProperty(r)&&Object.defineProperty(n,r,{writable:!0,enumerable:!0,configurable:!0,value:[]}),n[r].push(e),n}),{});return Object.keys(e).forEach((function(t){var n=new j(e[t]);e[t]=n.pack()})),Object.keys(e).map((function(t){return t+"¦"+e[t]})).join("|")},t.unpack=function(t){var n=t.split("|").reduce((function(t,n){var e=n.split("¦");return t[e[0]]=e[1],t}),{}),e={};return Object.keys(n).forEach((function(t){var r=O(n[t]);"true"===t&&(t=!0);for(var o=0;o<r.length;o++){var i=r[o];!0===e.hasOwnProperty(i)?!1===Array.isArray(e[i])?e[i]=[e[i],t]:e[i].push(t):e[i]=t}})),e},t.version="2.3.1",Object.defineProperty(t,"__esModule",{value:!0})}));
